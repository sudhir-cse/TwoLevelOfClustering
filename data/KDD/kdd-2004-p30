Recovering Latent Time-Series from their Observed Sums:
Network Tomography with Particle Filters.


Edoardo Airoldi


Data Privacy Laboratory
School of Computer Science
Carnegie Mellon University

eairoldi@cs.cmu.edu
Christos Faloutsos


School of Computer Science
Carnegie Mellon University

christos@cs.cmu.edu



ABSTRACT
Hidden variables, evolving over time, appear in multiple set-
tings, where it is valuable to recover them, typically from ob-
served sums. Our driving application is 'network tomogra-
phy', where we need to estimate the origin-destination (OD)
traffic flows to determine, e.g., who is communicating with
whom in a local area network. This information allows net-
work engineers and managers to solve problems in design,
routing, configuration debugging, monitoring and pricing.
Unfortunately the direct measurement of the OD traffic is
usually difficult, or even impossible; instead, we can easily
measure the loads on every link, that is, sums of desirable
OD flows.
In this paper we propose i-FILTER, a method to solve
this problem, which improves the state-of-the-art by (a) in-
troducing explicit time dependence, and by (b) using real-
istic, non-Gaussian marginals in the statistical models for
the traffic flows, as never attempted before. We give experi-
ments on real data, where i-FILTER scales linearly with new
observations and out-performs the best existing solutions, in
a wide variety of settings. Specifically, on real network traf-
fic measured at CMU, and at AT&T, i-FILTER reduced the
estimation errors between 15% and 46% in all cases.

This
author thanks the Data Privacy Laboratory and the
Center for Automated Learning and Discovery (CALD) at
Carnegie Mellon University for their support.
This
author thanks the support by the National Science
Foundation under Grants No.
IIS-0083148, IIS-0113089,
IIS-0209107, IIS-0205224, INT-0318547, SENSOR-0329549,
EF-0331657, IIS-0326322 and by the Pennsylvania Infras-
tructure Technology Alliance (PITA) Grant No.
22-901-
0001. Additional funding was provided by donations from
Intel, and by a gift from Northrop-Grumman Corporation.
Any opinions, findings, and conclusions or recommendations
expressed in this material are those of the author(s) and
do not necessarily reflect the views of the National Science
Foundation, or other funding parties.




Permission to make digital or hard copies of all or part of this work for
personal or classroom use is granted without fee provided that copies are
not made or distributed for profit or commercial advantage and that copies
bear this notice and the full citation on the first page. To copy otherwise, to
republish, to post on servers or to redistribute to lists, requires prior specific
permission and/or a fee.
KDD'04, August 22­25, 2004, Seattle, Washington, USA.
Copyright 2004 ACM 1-58113-888-1/04/0008 ...$5.00.
Categories and Subject Descriptors: I.2.6 [Artificial
Inteligence]: Learning
General Terms: Algorithms
Keywords: Origin-Destination Traffic Flows, Link Loads,
self-organizing Bayesian Dynamical System, MCMC, Parti-
cle Filter, Informative Priors, Empirical Bayes

1. INTRODUCTION
Knowledge about the origin-destination (OD) traffic ma-
trix allows network engineers and managers to solve prob-
lems in design, routing, configuration debugging, monitoring
and pricing; in fact the OD traffic matrix provides valuable
information about who is communicating with whom in a
network, at any given time. Unfortunately the direct mea-
surement of the OD traffic is usually difficult, or even infea-
sible, in real networks. The direction of current research is
to develop methods to infer the OD traffic flows from ob-
served traffic loads on the links of the network, however the
methods that have been proposed so far seem not to fully
take advantage of two of the main empirically observed fea-
tures of network traffic; namely its very skewed marginal
distribution, and its time dependent nature.




Figure 1: Estimation error in
2
distance.

In this paper we present i-FILTER, an intelligent filtering
method which improves the models present in the literature
by introducing two realistic assumptions:

· the successful log-Normal distribution provides a real-
istic model for the marginal OD traffic flows,
· time dependence between successive flows on a same
OD route narrows the variability of the estimates.



30
Research Track Paper

i-FILTER uses a two-stage estimation procedure: estimates
the pattern of time-dependencies, and eventually uses it to
gain in precision.

· the learning algorithm is linear in the number of epochs
times the number of OD flows that need be recovered,


· the learning algorithm (particle filter) estimates the
parameters of our Bayesian dynamical system and the
OD traffic flows with one pass over the data, using few
high-quality particles.

In our experiments, using the best log-Normal model re-
duced the estimation error of previously proposed meth-
ods by 35%, and the introduction of explicit stochastic dy-
namical behavior reduced the estimation error up to 46%.
The magnitude of the improvements entailed by the sim-
ple ideas we propose goes far beyond that of state-of-the-art
re-sampling schemes that could be used to refine any given
set of estimates. Further a stochastic dynamical behavior
played an essential role in our models; it served as the right
channel where to introduce prior information about the OD
flows, gained in stage-one of our procedure.
The rest of the paper is organized as follows: Section 2
describes the problem and the relevant issues in more detail.
Section 3 surveys the relevant literature. Section 4 describes
our proposed methodology.
Section 5 reports the results
of our experiments on real data.
Section 6 discusses our
main findings and their relevance towards our solution to the
problem, and Section 7 concludes with some final remarks
and future research directions.

2. PROBLEM - BACKGROUND
In this paper we write M for matrices, v(t) for column
vectors at time t, and v(i, t) for their generic component i.

T
Number of time points.
Number of observable link loads.

Number of non-observable OD flows.
A
( × ) fixed routing matrix.
Y
( × T ) matrix of link loads.
X
( × T ) matrix of OD flows.

( × T ) matrix of means of X |, .

(1 × T ) vector of scale factors for X |, .

Generic vector of hyper-parameters.
()
Generic prior distribution.

Table 1: Summary of symbols.

We begin by defining the problem, introducing the rele-
vant issues, and discussing related works.

2.1 The Problem and its Facets
In a formulation of the problem we want to solve there
are several time series which we would like to estimate, but
which we cannot observe, say, a vector of traffic flows x(t)
over times t = 1, ..., T . However, we are able to observe
linear combinations of these traffic flows, the vector of link
loads y(t) over times t = 1, ..., T , and we know which compo-
nents of x(t) mix into each of the components y(i, t) at each
time t trough the routing matrix A, that does not change
over time. This problem can be decomposed in three sub-
problems, which we now define.
Problem 1. (Network Tomography)
Given the matrix of
link loads Y(
×T)
and a routing matrix A(
×)
, we want to
find the matrix of non-observable OD traffic flows X(×
T )
such that Y = A · X. Always  > .

For example, the linear equations that correspond to the
routing scheme of the star network in figure 2 below are:

2
4
y(1, t)
y(2, t)
y(3, t)
3
5
=
2
4
1
1
0
0
0
0
1
1
1
0
1
0
3
5
2
6
6
4
x(1, t)
x(2, t)
x(3, t)
x(4, t)
3
7
7
5
(1)



y(1, t) measures the traffic load on the link from node 1 to
the router and captures both the OD flow from node 1 to
node 2, x(2, t), and the OD flow from node 1 to itself, x(1, t).
y(3, t) measures the traffic load on the link from the router
to node 1 and captures both the OD flow from node 2 to
node 1, x(3, t), and the OD flow from node 1 to itself, x(1, t).




 
¡
¢
£
¤
¥
 
¡
¦
£
¤
¥
 
¡
§
£
¤
¥




 
¡
¨
£
¤
¥
©





































¡
¤
¥

!
"
#
$
%
&
¡
§
£
¤
¥
&
¡
¨
£
¤
¥
&
¡
¢
£
¤
¥
&
¡
¦
£
¤
¥




'
¡
¤
¥

#
(
)
0
#
1
!
%




Figure 2: Two subnetworks connect to a router in a
small star network. We observe the link loads (solid blue
arrows), and want to infer the hidden OD flows (dashed
red arrows).


In the example above we want to estimate four () un-
observable quantities starting from three ( ) independent
observations1. The system is under-specified,  >
, hence
some extra information is needed in order to identify one
single solution.

Problem 2. (Prejudices)
Choose a set of additional con-
straints to be imposed on X(×
T )
in order to make the "net-
work tomography" problem exactly determined.

The likelihood of the data entailed by a statistical model
provides us with a natural criterion to discern "likely" solu-
tions from unreasonable ones. Following this idea we model
the unobservable quantities x(t) with a joint probability dis-
tribution; this induces a probabilistic mapping on the space
of the observations y(t) via equation 1, so that we can com-
pute the likelihood of the observations, and look for traffic
flows that maximize the probability of particular data ob-
servations. Unfortunately in time-independent models the
likelihood of y(t) is not necessarily unimodal, even as we as-
sume independent components in x(t), and even as we use
well-behaved functional forms for their distributions. More
information is needed to identify a solution.
At this point there are two main ways to introduce the
extra information we need.
In a purely data-driven ap-
proach we would augment the data in some way, whereas
in a knowledge-driven approach we would make use of infor-
mative priors in a Bayesian setting, with the complication

1
We assume that routers neither generate nor absorb traffic.



31
Research Track Paper

2
3
4
5
2
3
6
5
2
3
7
5




8
3
6
5
8
3
7
5
2
3
6
5
2
3
7
5




8
3
6
5
8
3
7
5




9
@
A
B
C
9
D
E
F
C
D
G
@
@
H
9
D
I
F
B
P
Q
R
B
R
F
S
Q
T
B
A
F
U
@
H
F
C
2
3
4
5
2
3
6
5
2
3
7
5




8
3
6
5
8
3
7
5
D
S
V
W
9
X
Y
`




a
b
I
B
c
D
A
d




3
4
5
d




3
6
5
d




3
7
5
X
W
U
Y
W
e
a
Y
f
Y
e
a
Y
e
X
X
W
U
Y
a
Y
f
Y
e
a
Y
e
X




Figure 3: Graphical representations: previous works assume no explicit time dependance (left), whereas the linear
SSM introduces an explicit dynamical behavior (center). Our proposed i-FILTER moves the explicit time dependence
one layer up in the graphical model, thus allowing for the OD flows to be more diverse (right).



in this latter case of defining what we mean by "informa-
tive". Data augmentation can be realized, for example, by
raising the likelihood of the data to a power, as in simulated
annealing, or by borrowing observations from epochs close
in time to the current one to obtain a smoothed average
solution. Alternatively, we can build "informative" priors
based on partial knowledge about the magnitude of the OD
flows, and update using Bayes rule and a "more accurate"
data model.

Problem 3. (Speed)
Solve efficiently the "network to-
mography" problem, under the "prejudices" of problem 2.

We offer a novel solution to the "prejudices" problem,
which satisfies the efficiency requirement of the "speed" prob-
lem. The two-stage estimation procedure at the core of i-
FILTER corresponds to a non-parametric empirical Bayes
learning strategy, where the observations are used to first
calibrate informative priors, and then to filter the posterior
distributions of the OD flows given the data.
Our solu-
tion: (1) uses realistic models for the OD flows; (2) takes
advantage of the time dependence of the data while using
the whole history of observations {y(1), ..., y(t)} to estimate
x(t) in a proper Bayesian fashion.

2.2 State-Space Models
To the best of our knowledge dynamical systems have
never been used to solve the "network tomography" prob-
lem2. Previous works assume independent OD flows across
different epochs. We use dynamical systems, which natu-
rally extend previous approaches by assuming time depen-
dence explicitly.

Definition 1. Gaussian linear state-space models are de-
fined by the set of equations,


x(t)
=
F · x(t - 1) + e(t)
y(t)
=
A(
×)
· x(t),
t  1
(2)

where {e(t)} is an i.i.d. Gaussian process with variance-
covariance matrix Q, and F is a known matrix. Further
x(0)  Normal (m, V ) and independent of e(t) for t  1.

2
Wei et al.
(2002) and others use HMMs to approach a
different problem, also called "network tomography".
In figure 3 above we show the graphical representations
for the "network tomography" problem at subsequent time
points in a static setting, and its natural extension to a dy-
namic setting, by means of various state-space models (SSM
henceforth). Classical state-space modeling strategies a la
Box and Jenkins would look for the additional constraints
needed to solve problem 2 in a known dynamical behav-
ior suggested by some physical law underlying the specific
problem at hand and from known seasonal patterns in the
traffic, for example the laws of motion in tracking the tra-
jectories of moving objects, or from the presence of strong
cross-correlations among the OD flows.
This knowledge
would translate into constraints on F , and Q in the sys-
tem 2 above, and would serve the critical role of driving the
inferences towards one particular solution.


3. RELATED WORK

3.1 Classical Literature
As we discussed above the "network tomography" prob-
lem is under-specified, and allows for infinite valid solu-
tions. Fienberg (1968, 1970) studied the geometry of the
underlying mathematical problem and identified the (- )-
dimensional space of solutions. By assuming specific margi-
nal probability distributions for the OD flows we induce a
probability map on the the space of measurements. Vander-
bei and Iannone (1994) show that assuming Poisson OD traf-
fic does not yield a necessarily convex probability map, and
Vardi (1996) further shows that solving the likelihood equa-
tions may yield local maximum whereas the actual global
maximum is on the boundary, assuming Poisson traffic. Both
these works assume a fixed vector of parameters for all epochs.
Tebaldi and West (1998) propose a fully Bayesian framework
with non-informative priors based on Poisson traffic and ac-
knowledge the need for informative priors, but they do not
specify how to obtain them. In fact, using the measurements
at time t in order to estimate the OD flows at the same
epoch, flat priors over the possible amount of traffic yield
uniform or multi-modal posteriors. Their work is important
in that they explore the extent to which it is possible to
find a solution at each epoch without using the information
entailed by past or future measurements.



32
Research Track Paper

Figure 4: A summary of the models present in the liter-
ature in terms of their ability to model relevant features
of real traffic data.


3.2 Recent Approaches
Solutions to the problem in the non-statistical literature
consider a fixed vector of parameters across all epochs as the
favorite solution to overcome the lack of information entailed
by the measurements. For example, a typical solution would
assume traffic flows at different epochs as independent for
each OD route and estimate a fixed vector of parameters by
composing the constraints given by the measurements via
generalized least squares. Similar solutions differ in the way
they compose the constraints given by the measurements at
different epochs; the alternatives include the assumptions
of multivariate Gaussian or multinomial measurements and
the composition is carried out via maximum likelihood or via
Bayes theorem, or else using maximum entropy arguments,
and so on. Economic approaches that explicitly deal with
congestion had also been tried with success. As we noted
above, these solutions all assume an underlying fixed vector
of parameters which governs the OD traffic at all epochs, and
we can express them as solutions of a common minimization
problem (Airoldi 2003, Zhang et al. 2003).
Several of these time-independent solutions have been ap-
plied locally in order to get a time-varying solution for the
OD flows, otherwise constant across time. A drawback of
such approaches is that they cannot obtain estimates for the
OD flows corresponding to several measurements. For ex-
ample, a window of 11 observations would not inform about
the first and last 5 OD flows ( 25 mins). A recent ap-
proach due to Cao et al. (2000) assumes multivariate Gaus-
sian OD flows, i.i.d. across time. However, they propose
a clever parametrization with several desirable properties
which yields reliable estimates. Further Cao et al. (2001)
show how to estimate OD traffic flows in bigger networks by
solving sub-problems and then composing their solutions.
Medina et al. (2002) compare several methods and survey
the literature. Zhang et al. (2003) propose a gravity model
for the OD traffic, and use Stein's shrinkage estimator to
refine their estimates.

3.3 Skewed and Bursty Traffic
The log-Normal distribution has never been used to model
the OD traffic flows, however several works support this
distribution for traffic in communication networks and over
the Internet. Empirical studies and theoretical models that
recreate realistic traffic flows from underlying processes con-
sistently come to the conclusion that network traffic flows
are skewed and bursty, see Mandelbrot (1965), Leland et
al. (1993), Coutin and Carmona (1998), Sarvotham et al.
(2001), Wang et al. (2002), and Cao et al. (2002). Most
of the skewed distributions follow the characterization given
by Zipf (1932), and its generalizations given by Mandelbrot
(1953) and Bi et al. (2001). In particular Bi et al. show that
the truncated log-Normal distribution is flexible enough to
fit a wide variety of such observed behaviors. We show the
log-log plots for the two data sets we used in figure 6 below.

3.4 Learning State-Space Models
Ghahramani and Hinton (1996) show how to learn all
the parameters in the system 2, in our case F , Q, m, and
V , by means of the EM algorithm. Higuchi (2001) shows
how a self-organizing system can be built from non-linear
non-Gaussian systems, so that all the relevant parameters
are learned during the filtering process. Gilks and Berzuini
(2001) propose a particle filter that keeps particles diverse.


4. PROPOSED METHOD: i-FILTER
Briefly, i-FILTER uses a two-stage approach to the filter-
ing problem. In the first stage we find preliminary, smooth
estimates for the OD flows, which make a good guess for the
averages of the OD traffic, and in the second stage we refine
these smooth estimates by looking for spikes and bursty pe-
riods with one single pass over the data. We model the OD
flows as Bayesian dynamical systems, and we use a EM and
particle filter as learning algorithms3.



g
h
i
p
q
r
s
h




t
i
s
u
u
v
w
x
y


q
r


s







y

u

q

r

p

s







r
s





Figure 5: A non-parametric empirical Bayes approach
to the filtering problem is at the core of i-FILTER.


More specifically, we use the linear Gaussian SSM and re-
lated EM steps proposed in Airoldi and Faloutsos (2004),
which includes the model in Cao et al. (2000) as a special
case, to obtain smooth estimates of the OD traffic, and we
then use these estimates to calibrate informative priors for
the parameters underlying the dynamic of a non-Gaussian
system, in non-parametric empirical Bayes fashion. Even-
tually the particle filter makes good use of these priors and
of the skewed models, and finds a sequence of better poste-
rior distributions for the traffic flow on each OD route; we
pick their means as point estimates. Our experiments show
i-FILTER achieves an error 15% to 46.5% smaller than that
of state-of-the-art methods in all cases.

4.1 Models for OD Traffic
In our experiments on Carnegie Mellon origin-destination
traffic we noticed that assuming a fixed relationship between
x(i, t) and x(i, t + 1) is an unrealistic constraint. Our solu-
tion is to assume a relationship between the means of the
OD flows (i, t) and (i, t+1) instead, and to allow for some
error. The SSM yields smooth estimates that capture infor-
mation about this relationship, which we pass to the next
estimation stage. In fact, we introduce soft constraints on
the average process {(t) t  1} in the form of informative
priors for the parameters underlying its dynamical behavior.

3
An implementation of i-FILTER described in this paper is
available for the open source R environment, on request.



33
Research Track Paper

We reduce the number of parameters by merging dynamic
and error terms into a stochastic dynamical behavior. The
marginal models for the OD traffic flows are independent
log-Normals4.
The main objects of interest are then the
posterior distributions P ( x(t) | y(1), ..., y(t) ). In particular
the point estimate for the OD traffic vector at time t is given
by the mean ^
x(t) = E( x(t) | y(1), ..., y(t) ).

4.1.1
i-FILTER Static
The static version of i-FILTER considers independent prob-
lems at each epoch. Briefly, we are interested in estimating
^
x(t) = E( x(t) | y(t) ) = E( x | y ). To specify the full models
at each time t we write:


x  , 
 p ` , ´
y
=
A · x,
(3)


where p is log-Normal, parametrized so that E( x(i) |,  ) =
(i), V ( x(i) |,  ) =  · (i) , Cov( x(i), x(j) |,  ) = 0 for
i = 1, ...,  and i = j. Notice that  is common across OD
flows at each epoch, and that  is a known scalar, which
we obtain by inspection of Y . The priors for the (i) are
log-Normal (1(i), 2(i))5, for i = 1, ...,  and independent
for i = j. The prior for  is proportional to a constant, to
1/ or to 1/2.

4.1.2
i-FILTER Dynamic
This dynamic version of i-FILTER, which yields the best
results, implements the following Bayesian dynamical sys-
tem:

(i, t)
=
(i, t) · (i, t - 1), i = 1, ...,  (4)
8
>
<
>
:
x(t)  (t), (t)
 p ` (t),(t)´
(5)
y(t)
=
A · x(t),
t  1,
(6)

where p is log-Normal, parametrized so that for i = 1, ..., 
E( x(i, t) |(t), (t) ) = (i, t), V ( x(i, t) |(t), (t) ) =  ·
(i, t) , and Cov( x(i, t), x(j, t) |,  ) = 0 for i = j. No-
tice that (t) is common across OD flows at time t, and
that  is a known scalar, which we obtain by inspection of
Y . The priors for (i, 0) are log-Normal ((i, 0), )4, for
i = 1, ...,  and independent for i = j, and for a big num-
ber  that accounts for the uncertainty of the means of OD
flows at time zero. The prior for (t) is proportional to a
constant, to 1/(t) or to 1/(t)2. The priors for (i, t) are
log-Normal (1(i, t), 2(i, t))4 for i = 1, ..., , and indepen-
dent for i = j.

4.1.3
Informative Priors for (t)
The crucial question at this point is: how do we cali-
brate the hyper-parameters underlying the prior distribu-
tions of (t)? First we obtain a preliminary set of estimates
^
x(t) with the Gaussian linear SSM. Then, in the case of i-
FILTER static, (1, 2) at each time are set so that mean
and variance of  correspond to those of ^
x(t). Variances
can be made much larger without significant loss of preci-
sion. The intuition is that the preliminary estimates indicate
us where OD flows are on average. In the case of i-FILTER
dynamic the intuition is the same, however it is not possi-
ble to set priors for (t) as the sequence {(1), ..., (T )} is
going to be determined by (0) alone. The solution is then

4
Airoldi (2003) also considers Gamma models.
5
Airoldi (2003) also considers Gamma, Uniform, and trun-
cated Gaussian priors.
to extract from {^
x(1), ..., ^
x(T )} information about their lo-
cal dynamical behavior and use it to calibrate informative
priors for { (t), t  1}. Technically, we set (i, t) as inde-
pendent log-Normals; we use the facts that product convo-
lution of log-Normals is log-Normal (equation 4), and that
log-Normal(1(i, t), 2(i, t)) = exp{ N(1(i, t), 2(i, t)) } to
solve the convolution problem exactly for (1(i, t), 2(i, t)),
for i = 1, ..., . In other words, values for (1(t), 2(t)) are
computed from (^
x(t), ^
x(t - 1)) at each time, and these pa-
rameters need not be learned. (i, 0) is set to be the average
of corresponding OD flow {x(i, t), t  1}.
Notice that every two-stage method that finds prelimi-
nary estimates and refines them uses {^
x(1), ..., ^
x(T )} in the
second stage, in some way. We prefer to translate this infor-
mation into information about the means of the OD flows
{(1), ..., (T)}, according to the intuition that preliminary
estimates can identify a smooth version of the OD flows we
are looking for, which make reasonable guesses for their un-
derlying average processes.

4.2 Parameter Estimation
In order to filter the posterior distributions of the origin-
destination flows and estimate the parameters of the mod-
els, i-FILTER implements a slight variation of the sample-
resample-move algorithm of Gilks and Berzuini (2001), which
we briefly outline below. For simplicity define v(t) to be the
vector of all parameters in the model at time t, v(t) :=
`x
(t), (t), (t), (t)´, and v(0) :=
`
(0)´.
Algorithm 1. Enhanced Particle Filter:

At t = 0 generate N particles {
~
(i
)
(0) }N
i=1
using (0), .

1. Set t = t + 1. Move each particle like so: (a) generate

(i)
(t) using (1,
(i)
(t), 1,
(i)
(t)), and (i
)
(t); (b) com-
pute (i
)
(t) using the equation 4; (c) generate x(i
)
(t)
by sampling from equation 5.

2. Resample N new particles from { ~
v(i
)
(t) }N
i=1
according
to the likelihood, P ( y(t) | ~
v(i
)
(t) ), they entail.

3. Move the new set of particles according to a MCMC
for "several steps" to improve their diversity. Go to 1.

For details about the MCMC see Airoldi (2003).

4.3 Scalability and Irreducibility
A recent result in network tomography (see Cao et al.
2001) is that it is possible to reformulate filtering problems
corresponding to complex networks as a sequence of prob-
lems corresponding to small, simple networks.

Lemma 1. The complexity of i-FILTER is O(  · T ).

Proof. We use results by Cao et al. (2001) which imply
that a tomography problem corresponding to a network with
 origin-destination flows is equivalent to O() tomography
problems, which correspond to disjoint sub-sets of, say, one
to four OD traffic flows in the original problem. This fact
along with the fact that our solution is linear in the number
of time points for which the OD traffic need be filtered,
yields a total complexity of O(  · T ) for i-FILTER.

Lemma 1 implies if we solve the "network tomography"
problem for small size networks, we immediately solve it for
arbitrary size networks with comparable estimation errors.
Further the following result holds:



34
Research Track Paper

4
6
8
10
12
14
16
18
20
22
24
0
2
4
6
8
10
12




log Traffic
log
Counts
Carnegie Mellon Traffic




2
4
6
8
10
12
14
0
1
2
3
4
5
6
7




log Traffic
log
Counts
AT&T Traffic




Figure 6: Left: a log-log plot of the 12100 traffic flows measured at Carnegie-Mellon university suggests that skewed
distributions are appropriate. Right: a log-log plot of the 16 traffic flows measured at AT&T, which we use as a test
bench for our models. i-FILTER yields the best performance when based on the successful log-Normal distribution.



Lemma 2. i-FILTER is based on an irreducible MCMC.

Proof. See Airoldi (2003)

Lemma 2 implies that i-FILTER is able to explore the
support of the whole joint posterior distribution of the OD
flows. A proof of this fact is needed since the MCMC uses
a Gibbs sampler with Metropolis steps.


5. EXPERIMENTS

5.1 Experiment Setup

5.1.1
Data Sets Description
We had two data sets available. Both of them included
validation data.

· Carnegie Mellon traffic: the first data set, which we
used to choose the appropriate model, contained about
12100 origin-destination traffic flows measured every 5
minutes over slightly less than two days at Carnegie-
Mellon university (CMU). We measured an average
traffic of 14GB every 5 minutes.

· AT&T traffic: the second data set, which we used to
test and compare the filtered traffic obtained with dif-
ferent methodologies, contained 16 origin-destination
flows measured every 5 minutes over a one-day period
at AT&T, courtesy of Dr. Jin Cao at Bell Labs.

The analysis of Carnegie Mellon origin-destination traffic
flows supports the hypothesis of a very skewed distribution.
In figure 6 we plotted the logarithms of the observed flows
versus the logarithms of the number of times measurements
of such a size appear (aka. log-log plot), after discarding the
measurements smaller than a standard packet (53 bytes =
424 bytes). The log-log plot indicates a log-Normal distri-
bution may be appropriate. A histogram of the logarithms
of the flows indicated that a logarithmic transformation is
actually too mild to remove all the skewness, and a dou-
ble logarithmic transformation would be more appropriate.
The AT&T data set is much smaller, and contains traffic
flows generated on a smaller network; they are less skewed
overall, and a logarithmic transformation is enough to yield
a symmetric histogram for the truncated flows.
5.1.2
Performance and Robustness
We used the CMU data set to drive our modeling choices,
on star network topologies. In order to test both the per-
formance of i-FILTER and the robustness of its underlying
log-Normal model we eventually set the CMU data aside,
and used the AT&T data set as an independent validation
data set.
Recall, as we noted in section §4.3 above, that it is possible
to break down a big filtering problem on a complex network
into a sequence of smaller problems on (disjoint) simple star
networks.
Hence, it was enough to test the performance
of our methods on the simple star network in figure 1, com-
posed by one router and two nodes connected to it. We used
subsets of non-observable origin-destination flows from the
AT&T data set, to generate the link loads corresponding to
the simple star network topology above, and then compared
the estimation errors of the competing methods in the task
of reconstructing the non-observable OD flows.

5.2 Results
Combining realistic models and time dependence into i-
FILTER reduced the error obtained with local likelihood
between 15.0% and 46.5%. We performed experiments to
answer the following questions:

1. Skewed Marginals: what is the impact of skewed model
on the accuracy of the estimates? And what is the best
model for the OD traffic?

2. Time Dependence: what is the impact of explicit time
dependence on the accuracy of the estimates?

3. Informative Priors: what constraints should we im-
pose to solve the "prejudice" problem? How do they
impact the accuracy of our estimates?

4. Scalability: does our algorithm scale well with the prob-
lem size?

We were most interested in assessing the differential impact
on the estimation error of our novel ideas, as opposed to
the methods present in the literature. That is, we measured
the goodness of the competing methods by computing the
corresponding estimation errors, as given by the
2
distances
between the true OD flows in the validation set and the
estimates. The best results were obtained with log-Normal
distribution for the flows and Gaussian vague priors.



35
Research Track Paper

Figure 7: The bars represent the average estimation error in a validation set. Specifically we plot the
2
distance
between the true OD flows and the corresponding estimates obtained with the local likelihood approach and i-FILTER
in its various flavors. i-FILTER based on the Bayesian dynamical system is a clear winner! In both panels we include
the estimates obtained with our Gaussian linear SSM. Left: error bars corresponding to i-FILTER based on Gamma
models. Right: error bars corresponding to i-FILTER based on log-Normal models.




Figure 8: Example posterior distributions for the OD flow x(2, 255). The traffic on the X axes is measured in Kbytes,
and the figures show the posterior distribution we obtained with i-FILTER static (left panel) versus the one we obtained
with i-FILTER dynamic (right panel), which encodes time dependence of the OD flows. The solid triangles represent
the true hidden OD Flow, whereas the empty triangles are our point estimates, which correspond to the means of the
posterior distributions. Time dependence entails that the posterior distribution of x(2, 255) depends on all observations
{y(1), ...,y(255) } and has a lower variability -- notice the different ranges -- thus improving the inference.



5.2.1
Effect of Skewed Marginals
To isolate the effect of realistic distributions for the OD
flows, we compared the estimates obtained with i-FILTER
where no time dependence was assumed, for Gamma and
log-Normal models, and a variety of non-conjugate priors
(Uniform, Gaussian, Gamma,l log-Normal) and different pa-
rametrizations, with the estimates obtained by local likeli-
hood. Introducing realistic model reduced the error between
25.4% and 40.8%. See figure 7.


5.2.2
Effect of Time Dependence
To isolate the effect of explicit time dependence, we com-
pared the estimates we obtained with the gaussian linear
SSM in Airoldi (2003) that uses independent AR(1) pro-
cesses for the OD flows, with the estimates obtained with
local likelihood. Introducing time dependence reduced the
error by 15.5% on average; the reduction ranged between
8.5% and 31.0%. See figures 7 and 8.
5.2.3
Informative Priors
In 60% of the time points uninformative priors yielded flat
or multi-modal posteriors, whereas in the remaining 40% of
the time points uninformative priors yielded wide uni-modal
posteriors. In the static case, the effect of one data point,
y(t), on the posterior, P (x(t)|y(t)), is on its range; impossi-
ble configurations receive zero posterior probability. On the
other hand, informative priors with wide variance all yielded
uni-modal distributions. Further, they have the advantage
of requiring fewer particles than uninformative priors; know-
ing where to sample may introduce bias, but the thick tails
of the log-Normal distribution of both x(t)|(t), (t) and
(t)|1(t), 2(t) mitigate the problem, and allow us to cap-
ture several of the hidden spikes. See figures 10 and 12.


5.2.4
Scalability
i-FILTER reconstructs the OD flows with one single pass
over the data; the first stage of the procedure and the cali-



36
Research Track Paper

bration of the priors are also linear in the problem size, as we
compute the posterior distributions using the gaussian lin-
ear SSM on a large sliding windows, for example. Figure 9
below shows that in less than one hour i-FILTER calibrates
the informative priors and recovers the flows corresponding
to one-day worth of data for the small network in figure 2,
on a Powerbook G4 1.25Ghz.




+
+
+
+
+
+
+
+
+
+
+
+
+




0
50
100
150
200
250
300
0
10
20
30
40




Time Points
Minutes




Figure 9: i-FILTER scales linearly with the problem
size (number of time ticks).



6. DISCUSSION
In this paper we propose i-FILTER, a two-stage procedure
which naturally fits in a non-parametric empirical Bayes
framework. i-FILTER reduced the estimation error6 in all
cases, and on average between 15% and 46.5%, when com-
pared to state-of-the-art methods on real traffic data. Such
improvements (see figure 11) are due to three factors:

1. realistic log-Normal distributions for the OD flows,

2. dynamical systems as a natural way to deal with data
with a temporal dimension,

3. informative priors calibrated via empirical Bayes,

Further, i-FILTER scales linearly with the size of the prob-
lem. Briefly, we recover a smooth version of the OD flows, we
use it to calibrate informative priors for some crucial param-
eters, and eventually we use a Bayesian dynamical system to
refine the estimates and capture bursty traffic. This method-
ology allows us to combine the three simple ideas above: a
realistic model for the data, the use of a filtering scheme
which takes advantage of time, probabilistic constraints to
overcome the under-determinacy of the problem.
More in detail, in the first stage we use the Gaussian linear
SSM proposed in Airoldi and Faloutsos (2004) to estimate a
smooth version of the OD traffic, and we calibrate informa-
tive priors for (t) using these estimates. These priors incor-
porate information about the magnitude and the dynamical
behavior of the OD traffic flows on average, and softly con-
strain the location of the average processes {(t), t  1}.
Other methods proposed in the literature make use of pre-
liminary estimates, but they only retain the information
about the magnitude of the OD flows given by the such es-
timates in the refining stage -- see for example Zhang et al.
(2003) who use shrinkage to improve the solutions given by
a gravity model. In our method, the fact that we retain also
the information about the local dynamical behavior yields
a significant jump in the final accuracy. Another channel

6
Measured in
2
distance from the true OD flows.
through which informative priors help achieve a better ac-
curacy is by reducing the bias entailed by multiple modes in
the posterior distributions. Making the posteriors more uni-
modal improves the precision of the point estimates of the
OD flows (the posterior means) as we show in figure 10 be-
low. Informative priors do drive the inferences about the OD
flows towards the preliminary guesses, however the two lay-
ers of our model and the use of soft probabilistic constraints
entail enough flexibility to capture several of the spikes in
many cases, for an example see figure 12 below. Further
our first-stage estimates are safely based on a model which
entails a one-to-one relationship between OD flows and mea-
surements, as it includes the model by Cao et al. (2000) as
a special case.
In the second stage the primary object of interest becomes
the sequence of posterior distributions P ( x(t) | y(1), ..., y(t) ).
We use their means
^
x(t) = E( x(t) | y(1), ..., y(t) ) as point
estimates for the OD flows at time t.
The Bayesian dy-
namical system brings further improvements, as we show
in figure 8 above, due to the fact that we make use of all
the observations up to time t in computing the posterior
distributions P ( x(t) | y(1), ..., y(t) ); conditioning on more
observations yields a narrower variability. Local methods
use fewer observations in a short window around t, instead.
The improvement i-FILTER achieves goes beyond the con-
tribution of state-of-the-art methods even when combined
with recent resampling schemes which improve any given
set of estimates.


7. CONCLUSIONS
In this paper we described i-FILTER, a two-stage estima-
tion method that combines three simple ideas:

1. log-Normal models to account for skewed, and bursty
unobservable OD traffic flows,

2. a novel Bayesian dynamical systems to take advantage
of the time dependence of the data and narrow the
variability of the estimates,

3. informative priors as soft constraints to overcome the
under-determinacy of the problem.

We offer simple heuristics to understand our modeling
choices; first-stage estimates capture smooth average pro-
cesses, second-stage estimates capture the spikes. We tested
our methodology on star topologies using real traffic mea-
sured at Carnegie Mellon (12100 OD flows) and AT&T (16
flows) and reduced by 15% to 46.5% the estimation error ob-
tained with state-of-the-art methods, in all cases. Finally,
we provided a solution to the problem of how to calibrate in-
formative priors in our Bayesian dynamical systems, where
no clear guidance about the dynamic of the hidden OD flows
is available. In the future we plan to explore whether peri-
odic traffic patterns may also be discovered successfully.


8. ACKNOWLEDGMENTS
The authors thank Dr. Stephen E. Fienberg for engaging
discussions, Dr. Jin Cao, Dr. Srinivasan Seshan, Dr. Rus-
sel Yount and Dr. Frank Kietzke for providing the traffic
data measured at AT&T and at Carnegie Mellon University,
which made this work possible, Dr. Irina Rish and Dr. Alina
Beygelzimer at IBM T.J. Watson for helpful comments.



37
Research Track Paper

Figure 10: Example posterior distributions for the OD flows x(3, 244) and x(4, 244). The traffic on the X axes is
measured in Kbytes, and the figures show the posterior distributions we obtained with non-informative priors (top
panel) and with informative priors (bottom panel) calibrated using our Gaussian linear SSM. The solid triangles
represent the true hidden OD Flows, whereas our point estimates would be the means of the posterior distributions.
Making the posteriors more unimodal improves the estimates by reducing the bias entailed by extra modes.




Figure 11: Left: the performance of the i-FILTER dynamic based on log-Normal marginals is quite amazing. The
goodness of the estimates can be appreciated after sharp changes in the hidden traffic flows. In such situations local
solutions tend to smooth the changes away. Right: The bars represent the average estimation error in a validation
set. Specifically we plot the
2
distance between the true OD flows and the corresponding estimates obtained with
the local likelihood approach and i-FILTER in its various flavors. We found that the i-FILTER static (Gamma and
log-Normal) improved the estimates obtained with local likelihood by 15% and 30%, respectively, and that i-FILTER
dynamic improved the estimates by 23% and 33%, respectively.


9. REFERENCES

[1] E. M. Airoldi. Advances in network tomography. Technical
Report CMU-CALD-03-101, Carnegie Mellon University, 2003.
[2] E. M. Airoldi and C. Faloutsos. Recovering Latent Time-Series
from their Observed Sums. Technical Report CMU-CS-04-130,
Carnegie Mellon University, 2004.
[3] Y. Bejerano, Y. Breitbart, M. Garofalakis, and R. Rastogi.
Physical topology discovery for large multi-subnet networks. In
Proceedings of IEEE INFOCOM, pages 342­352, 2003.
[4] Z. Bi, C. Faloutsos, and F. Korn. The DGX distribution for
mining massive, skewed data. In Proceedings of ACM
SIGKDD, pages 17­26, 2001.
[5] J. Cao, D. Davis, S. Van Der Viel, and B. Yu. Time-varying
network tomography: router link data. Journal of the
American Statistical Association, 95:1063­75, 2000.
[6] J. Cao, D. Davis, S. Van Der Viel, B. Yu, and Z. Zu. A
scalable method for estimating network traffic matrices from
link counts. Technical report, Bell Labs, 2001.
[7] S. E. Fienberg. The geometry of an r × c contingency table.
Annals of Mathematical Statistics, 39:1186­90, 1968.
[8] S. E. Fienberg. The geometry of a two by two contingency
table. Journal of the American Statistical Association,
65:694­701, 1970a.
[9] W. R. Gilks and C. Berzuini. Following a moving target --
monte carlo inference for dynamic bayesian models. Journal of
the Royal Statistical Society, Series B, 63:127­146, 2001.
[10] T. Higuchi. Self-organizing time series model. In A. Doucet,
N. de Freitas, and N. Gordon, editors, Sequential Monte Carlo
Methods in Practice. Springer-Verlag, 2001.
[11] G. Liang and B. Yu. Pseudo-likelihood estimations in network
tomography. In Proceedings of IEEE INFOCOM, 2003.
[12] J. Liu. Monte Carlo Strategies in Scientific Computing.
Springer-Verlag, 2001.
[13] B. Mandelbrot. An informational theory of the statistical
structure of language. In W. Jackson, editor, Communication
Theory. Butterworths, 1953.




38
Research Track Paper

2 am
6 am
10 am
2 pm
6 pm
10 pm
20 Kb
40 Kb
60 Kb
node 1 --> node 1




2 am
6 am
10 am
2 pm
6 pm
10 pm
100 Kb
200 Kb
300 Kb
node 1 --> node 2




2 am
6 am
10 am
2 pm
6 pm
10 pm
50 Kb
200 Kb
350 Kb
node 2 --> node 2




2 am
6 am
10 am
2 pm
6 pm
10 pm
200 Kb
400 Kb
600 Kb
800 Kb
node 2 --> node 1




Figure 12: Example fits: actual hidden flows (solid black lines) versus reconstructed flows (dashed red lines). Notice
how well we manage to reconstructs several spikes. This figure prints better in colors.



[14] A. Medina, N. Taft, K. Salamatian, S. Bhattacharyya, and
C. Diot. Traffic matrix estimation: existing techniques and
new directions. In Proceedings of ACM SIGCOMM, pages
161­174, 2002.
[15] I. Rish, M. Brodie, and S. Ma. Accuracy vs. efficiency
trade-offs in probabilistic diagnosis. In Proceedings of AAAI,
2002.
[16] I. Rish, M. Brodie, N. Odintsova, S. Ma, and G. Grabarnik.
Real-time problem determination in distributed systems using
active probing. To appear in NOMS, 2004.
[17] C. and G. Casella. Monte Carlo Statistical Methods.
Springer-Verlag, 1999.
[18] C. Tebaldi and M. West. Bayesian inference on network traffic
using link count data. Journal of the American Statistical
Association, 93:557­576, 1998.
[19] R. J. Vanderbei and J. Iannone. An em approach to od matrix
estimation. Technical Report SOR 94-04, Princeton University,
1994.
[20] Y. Vardi. Network tomography: estimating source-destination
traffic intensities from link data. Journal of the American
Statistical Association, 91:365­377, 1996.
[21] S. Vaton and A. Gravey. Iterative bayesian estimation of
network traffic matrices in the case of bursty flows. In
Proceedings of the second ACM SIGCOMM Workshop on
Internet measurment, pages 89­90, 2002.
[22] W. Wei, B. Wang, D. Towsley. Continuous-time Hidden
Markov Models for Network Performance Evaluation.
Performance Evaluation, 49:129­146, 2002.
[23] Y. Zhang, M. Roughan, N. Duffield, and A. Greenberg. Fast
accurate computation of large-scale IP traffic matrices from
link loads. In Proceedings of SIGMETRICS, 2003.
[24] Y. Zhang, M. Roughan, C. Lund, and D. Donoho. An
information-theoretic approach to traffic matrix estimation. In
Proceedings of SIGCOMM, 2003.
[25] G. K. Zipf. Selected Studies of the Principle of Relative
Frequency in Language. Harvard University Press, 1932.




39
Research Track Paper

